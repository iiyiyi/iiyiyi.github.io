<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      &lt;AVL&gt;Luogu3369 Height-balanced BST | OnE 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Yi Cai">
    
    

    <meta name="description" content="Link:https://www.luogu.com.cn/problem/P3369   Brief DescriptionImplement a height-balanced binary tree that supports the following opereations:  Insert a number $x$ Delete the number $x$. If there are">
<meta name="keywords" content="AVL">
<meta property="og:type" content="article">
<meta property="og:title" content="&lt;AVL&gt;Luogu3369 Height-balanced BST | OnE">
<meta property="og:url" content="http://yoursite.com/child/2020/12/24/luogu3369/index.html">
<meta property="og:site_name" content="OnE">
<meta property="og:description" content="Link:https://www.luogu.com.cn/problem/P3369   Brief DescriptionImplement a height-balanced binary tree that supports the following opereations:  Insert a number $x$ Delete the number $x$. If there are">
<meta property="og:locale" content="EN/CN">
<meta property="og:image" content="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation.png">
<meta property="og:image" content="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation1.png">
<meta property="og:image" content="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation2.png">
<meta property="og:updated_time" content="2020-12-30T16:24:32.440Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="&lt;AVL&gt;Luogu3369 Height-balanced BST | OnE">
<meta name="twitter:description" content="Link:https://www.luogu.com.cn/problem/P3369   Brief DescriptionImplement a height-balanced binary tree that supports the following opereations:  Insert a number $x$ Delete the number $x$. If there are">
<meta name="twitter:image" content="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation.png">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">OnE</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          Algorithms Daily!
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Blogs</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">About</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">Archive</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/iiyiyi" title="Huno on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--
    
      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>

    -->



  </ul>
</nav>



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">&lt;AVL&gt;Luogu3369 Height-balanced BST</h1>

    

    <div class="post-meta">
      <time datetime="2020-12-24" class="post-meta__date date">2020-12-24</time> 

      <span class="post-meta__tags tags">

          
            <font class="categories">
            &#8226; Category:
            <a class="categories-link" href="/categories/Data-Structure-Tree/">Data Structure - Tree</a>
            </font>
          

          
             &#8226; Tag:
            <font class="tags">
              <a class="tags-link" href="/tags/AVL/">AVL</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p><strong>Link:</strong><a href="https://www.luogu.com.cn/problem/P3369" target="_blank" rel="noopener">https://www.luogu.com.cn/problem/P3369</a>  </p>
<h1 id="Brief-Description"><a href="#Brief-Description" class="headerlink" title="Brief Description"></a>Brief Description</h1><p>Implement a height-balanced binary tree that supports the following opereations:</p>
<ol>
<li>Insert a number $x$</li>
<li>Delete the number $x$. If there are multiple $x$s in the tree, delete only one of them.</li>
<li>Query the rank of $x$. Here, rank means the amount of numbers less than $x$ $+1$.</li>
<li>Query the number that ranks $x$th.</li>
<li>Find the predecessor of $x$, i.e. the largest number less than $x$.</li>
<li>Find the successor of $x$, i.e. the smallest number greater than $x$.  </li>
</ol>
<h1 id="Algorithm-Analysis"><a href="#Algorithm-Analysis" class="headerlink" title="Algorithm Analysis"></a>Algorithm Analysis</h1><p>The problem can be solved using <strong>AVL tree</strong>(named after inventors Adelson-Velsky and Landis).<br>In an AVL tree, the heights of the two subtrees of any node differ by at most one; otherwise, we have to rotate the tree to restore this property.</p>
<h2 id="Type-Definition"><a href="#Type-Definition" class="headerlink" title="Type Definition"></a>Type Definition</h2><p>AVL tree can be defined using <code>struct</code> in C++. Note that if we insert duplicated number into the tree, we will just store them in the same node and keep recording the amount of duplicated numbers in this node.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avlTree</span>&#123;</span></span><br><span class="line">    Elem data;  <span class="comment">// the data field</span></span><br><span class="line">    <span class="keyword">int</span> height; <span class="comment">// the height of the tree with the current node as the root</span></span><br><span class="line">    <span class="keyword">int</span> size; <span class="comment">// the size of the tree with the current node as the root</span></span><br><span class="line">    <span class="keyword">int</span> cnt; <span class="comment">// the number of duplicated data in the current node</span></span><br><span class="line">    avlTree *left; <span class="comment">// the pointer to the left subtree</span></span><br><span class="line">    avlTree *right; <span class="comment">// the pointer to the right subtree</span></span><br><span class="line">    avlTree()&#123; <span class="comment">// construction function</span></span><br><span class="line">        size = cnt = <span class="number">1</span>;</span><br><span class="line">        height = <span class="number">0</span>;</span><br><span class="line">        left = <span class="literal">NULL</span>;</span><br><span class="line">        right = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lsize</span><span class="params">()</span></span>&#123; <span class="comment">// the function that returns the size of the left subtree</span></span><br><span class="line">        <span class="keyword">if</span> (left == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> left-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">rsize</span><span class="params">()</span></span>&#123; <span class="comment">// the function that returns the size of the right subtree</span></span><br><span class="line">        <span class="keyword">if</span> (right== <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> right-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="Key-Step-Rotation"><a href="#Key-Step-Rotation" class="headerlink" title="Key Step: Rotation"></a>Key Step: Rotation</h2><p>The following picture shows the four cases when the property is broken.  In the first two cases, left rotation is required, while in the other two cases, right is required.<br><img src="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation.png" alt="Rotation1"><br>In the first case, the height of the left subtree of the left subtree is greater than that of the right subtree of the left subtree. Hence, the tree should be rotated as shown in the following picture.<br><img src="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation1.png" alt="Rotation2"><br>In the second case, the height of the right subtree of the left subtree is greater than that of the left subtree of the left subtree. Hence, the tree should be rotated as shown in the following picture. It is obvious that now the tree is similar to that is in the first case and thus we can rotate it again to restore the balancing property.<br><img src="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation2.png" alt="Rotation3"><br>The remaining two cases can be solved in similar ways.<br><em>In case you can’t see the pictures, click <a href="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation.png" target="_blank" rel="noopener">RotationCases</a>, <a href="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation1.png" target="_blank" rel="noopener">RotationCase1</a> and <a href="http://yc440.user.srcf.net/wp-content/uploads/2020/12/Rotation2.png" target="_blank" rel="noopener">RotationCase2</a> to see the images.</em></p>
<h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><p>Note that after each operation, the height and size of the current node may be changed. Therefore, we should keep updating these two variables.</p>
<h2 id="Insertion"><a href="#Insertion" class="headerlink" title="Insertion"></a>Insertion</h2><p>Inserting a node is similar to what we do in basic binary search trees. Note that we should rotate and update each node on the way.</p>
<h2 id="Deletion"><a href="#Deletion" class="headerlink" title="Deletion"></a>Deletion</h2><p>Deleting a node is also similar to what we do in basic binary search trees. There are three possible cases to consider:</p>
<ul>
<li>If the node to be deleted has no child, simply remove it from the tree.</li>
<li>If the node has only one subtree, remove it and replace it with its child.</li>
<li>If the node has two subtress, find its successor, remove it and replace it with its successor.<br>Note that we should also rotate and update each node on the way.  </li>
</ul>
<h2 id="Predecessor-and-Successor"><a href="#Predecessor-and-Successor" class="headerlink" title="Predecessor and Successor"></a>Predecessor and Successor</h2><p>Finding the predecessor and the successor is also similar to what we do in basic binary search trees.<br>To find the predecessor of $x$, if the data contained in the current value is greater than $x$, recursively search the left subtree. Otherwise, update the maximum we’ve found which is less than $x$ so far and then recursively search the right subtree.<br>The successor can be found in the similar way.</p>
<h2 id="Rank"><a href="#Rank" class="headerlink" title="Rank"></a>Rank</h2><p>Searching for the number ranks $i$th and querying the rank of a number $x$ is also simialr to what we do in basic binary search trees.<br>When searching for the number ranks $i$th in the tree, there are three possibilities:  </p>
<ul>
<li>If $i$ is less than or equal to the size of the leftsubtree, search for the number ranks $i$th in the left subtree.  </li>
<li>If $lsize()+1 &lt;= i &lt;= lsize()+cnt$, the current node is just the number we are searching for.  </li>
<li>Otherwise, search for the $i-lsize()-cnt$th number in the right subtree.<br>When querying the rank of a number $x$, there are three possibilites:  </li>
<li>If current node is just $x$, $rank=lsize+1$.  </li>
<li>If $x$ is in the left subtree, search the left subtree.  </li>
<li>If $x$ is in the right subtree, the rank is equal to the size $lsize+cnt+$ the rank of $x$ in the right subtree.  </li>
</ul>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Yiyi on 2020/12/14.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">#include&lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include&lt;cstdio&gt;</span></span><br><span class="line"><span class="comment">#include&lt;algorithm&gt;</span></span><br><span class="line"><span class="comment">#define Elem int</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF=<span class="number">0x7fffffff</span>;</span><br><span class="line">using <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max(<span class="keyword">int</span> a, <span class="keyword">int</span> b)&#123;</span><br><span class="line">    <span class="keyword">return</span> (a&gt;b)?a:b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct avlTree&#123;</span><br><span class="line">    Elem data;  <span class="comment">// the data field</span></span><br><span class="line">    <span class="keyword">int</span> height; <span class="comment">// the height of the tree with the current node as the root</span></span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">int</span> cnt; <span class="comment">// the number of duplicated data</span></span><br><span class="line">    avlTree *left;</span><br><span class="line">    avlTree *right;</span><br><span class="line">    avlTree()&#123; <span class="comment">// construction function</span></span><br><span class="line">        size = cnt = <span class="number">1</span>;</span><br><span class="line">        height = <span class="number">0</span>;</span><br><span class="line">        left = <span class="keyword">NULL</span>;</span><br><span class="line">        right = <span class="keyword">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> lsize()&#123;</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="keyword">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> left-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> rsize()&#123;</span><br><span class="line">        <span class="keyword">if</span> (right== <span class="keyword">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> right-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">avlTree* rt = <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line">void update(avlTree* &amp;root)&#123;</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">/*update the size after rotation*/</span></span><br><span class="line">    <span class="comment">/*size = lsize() + rsize()*/</span></span><br><span class="line">    root-&gt;size = root-&gt;cnt;</span><br><span class="line">    root-&gt;size += root-&gt;lsize();</span><br><span class="line">    root-&gt;size += root-&gt;rsize();</span><br><span class="line">    <span class="comment">/*update the height after rotation*/</span></span><br><span class="line">    <span class="comment">/*height = max(left_subtree_height + right_subtree_height) + 1*/</span></span><br><span class="line">    <span class="keyword">int</span> new_height = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) new_height = max(new_height, root-&gt;left-&gt;height);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right) new_height = max(new_height, root-&gt;right-&gt;height);</span><br><span class="line">    root-&gt;height = new_height + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avlTree* rightRotate(avlTree* &amp;root)&#123;</span><br><span class="line">    avlTree* tmp = root-&gt;left;</span><br><span class="line">    root-&gt;left = tmp-&gt;right;</span><br><span class="line">    tmp-&gt;right = root;</span><br><span class="line">    update(root);</span><br><span class="line">    update(tmp);</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avlTree* leftRotate(avlTree* &amp;root)&#123;</span><br><span class="line">    avlTree* tmp = root-&gt;right;</span><br><span class="line">    root-&gt;right = tmp-&gt;left;</span><br><span class="line">    tmp-&gt;left = root;</span><br><span class="line">    update(root);</span><br><span class="line">    update(tmp);</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void rotate(avlTree* &amp;root)&#123;</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> lheight = <span class="number">0</span>, rheight = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) lheight = root-&gt;left-&gt;height;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right) rheight = root-&gt;right-&gt;height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (abs(lheight - rheight) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        avlTree* tmp = (lheight &gt; rheight)? root-&gt;left:root-&gt;right;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> tlheight = <span class="number">0</span>, trheight = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (tmp-&gt;left) tlheight = tmp-&gt;left-&gt;height;</span><br><span class="line">        <span class="keyword">if</span> (tmp-&gt;right) trheight = tmp-&gt;right-&gt;height;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lheight &gt; rheight &amp;&amp; tlheight &lt; trheight) root-&gt;left = leftRotate(tmp);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lheight &lt; rheight &amp;&amp; tlheight &gt; trheight) root-&gt;right = rightRotate(tmp);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lheight &gt; rheight) root = rightRotate(root);</span><br><span class="line">        <span class="keyword">else</span> root = leftRotate(root);</span><br><span class="line">    &#125;</span><br><span class="line">    update(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void insert(avlTree* &amp;root, Elem d)&#123; <span class="comment">// sigh represents whether we can have duplicate elements in AVL</span></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">NULL</span>)&#123;</span><br><span class="line">        root = <span class="keyword">new</span> avlTree;</span><br><span class="line">        root-&gt;data = d;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (d == root-&gt;data)&#123;</span><br><span class="line">        root-&gt;cnt++;</span><br><span class="line">        root-&gt;size++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (d&lt;root-&gt;data)&#123;</span><br><span class="line">        insert(root-&gt;left, d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        insert(root-&gt;right, d);</span><br><span class="line">    &#125;</span><br><span class="line">    rotate(root);</span><br><span class="line">    update(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avlTree* query(avlTree* &amp;root, Elem d)&#123;</span><br><span class="line">    <span class="keyword">if</span> (root)&#123;</span><br><span class="line">        <span class="keyword">if</span> (d == root-&gt;data) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (d &lt; root-&gt;data) <span class="keyword">return</span> query(root-&gt;left, d);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> query(root-&gt;right, d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">avlTree* successorNode(avlTree* &amp;root)&#123;</span><br><span class="line">    avlTree* ret = root;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left) ret = successorNode(root-&gt;left);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;right)&#123;</span><br><span class="line">        root = root-&gt;right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        root = <span class="keyword">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    rotate(root);</span><br><span class="line">    update(root);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void deleteAvl(avlTree* &amp;root, Elem d)&#123;</span><br><span class="line">    avlTree ret;</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;data!=d)&#123;</span><br><span class="line">        <span class="keyword">if</span> (d &lt; root-&gt;data) deleteAvl(root-&gt;left, d);</span><br><span class="line">        <span class="keyword">else</span> deleteAvl(root-&gt;right, d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;cnt &gt; <span class="number">1</span>)&#123;</span><br><span class="line">            root-&gt;cnt--;</span><br><span class="line">            root-&gt;size--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;right==<span class="keyword">NULL</span>)&#123; <span class="comment">// right son is empty</span></span><br><span class="line">            avlTree* tmp = root;</span><br><span class="line">            root = root-&gt;left;</span><br><span class="line">            delete tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;left==<span class="keyword">NULL</span>)&#123;</span><br><span class="line">            avlTree* tmp = root;</span><br><span class="line">            root = root-&gt;right;</span><br><span class="line">            delete tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            avlTree* tmp = successorNode(root-&gt;right);</span><br><span class="line">            <span class="comment">// t is the successor of the root</span></span><br><span class="line">            <span class="comment">// i-&gt;e-&gt; the minimum node in the right subtree</span></span><br><span class="line">            root-&gt;data = tmp-&gt;data;</span><br><span class="line">            root-&gt;cnt = tmp-&gt;cnt;</span><br><span class="line">            delete tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    rotate(root);</span><br><span class="line">    update(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> successor(avlTree* &amp;root, <span class="keyword">int</span> x)&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = INF;</span><br><span class="line">    avlTree* tmp = root;</span><br><span class="line">    <span class="keyword">while</span> (tmp)&#123;</span><br><span class="line">        <span class="keyword">if</span> (tmp-&gt;data &gt; x)&#123;</span><br><span class="line">            ans = min(tmp-&gt;data, ans);</span><br><span class="line">            tmp = tmp-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> tmp = tmp-&gt;right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> predecessor(avlTree* &amp;root, <span class="keyword">int</span> x)&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = -INF;</span><br><span class="line">    avlTree* tmp = root;</span><br><span class="line">    <span class="keyword">while</span> (tmp)&#123;</span><br><span class="line">        <span class="keyword">if</span> (tmp-&gt;data &lt; x)&#123;</span><br><span class="line">            ans = max(tmp-&gt;data, ans);</span><br><span class="line">            tmp = tmp-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> tmp = tmp-&gt;left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> getrank(avlTree* &amp;root, <span class="keyword">int</span> x)&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == root-&gt;data) <span class="keyword">return</span> (root-&gt;lsize() + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x &lt; root-&gt;data) <span class="keyword">return</span> getrank(root-&gt;left, x);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> (root-&gt;lsize() + root-&gt;cnt + getrank(root-&gt;right, x));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> getnum(avlTree* &amp;root, <span class="keyword">int</span> x)&#123;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;lsize()+<span class="number">1</span> &lt;= x &amp;&amp; root-&gt;lsize()+root-&gt;cnt &gt;= x)</span><br><span class="line">        <span class="keyword">return</span> root-&gt;data;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;lsize() &gt;= x) <span class="keyword">return</span> getnum(root-&gt;left, x);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> getnum(root-&gt;right, x - root-&gt;lsize() - root-&gt;cnt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="keyword">print</span>(avlTree* &amp;root)&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">"data:"</span>&lt;&lt;root-&gt;data;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left!=<span class="keyword">NULL</span>) cout&lt;&lt;<span class="string">" lsize:"</span>&lt;&lt;root-&gt;lsize()&lt;&lt;<span class="string">" left:"</span>&lt;&lt;root-&gt;left-&gt;data;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right!=<span class="keyword">NULL</span>) cout&lt;&lt;<span class="string">" rsize:"</span>&lt;&lt;root-&gt;rsize()&lt;&lt;<span class="string">" right:"</span>&lt;&lt;root-&gt;right-&gt;data;</span><br><span class="line">    cout&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left!=<span class="keyword">NULL</span>) <span class="keyword">print</span>(root-&gt;left);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right!=<span class="keyword">NULL</span>) <span class="keyword">print</span>(root-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main()&#123;</span><br><span class="line">    Elem a;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    scanf(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="keyword">int</span> op;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)&#123;</span><br><span class="line">        scanf(<span class="string">"%d%d"</span>, &amp;op, &amp;a);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == op) insert(rt, a);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> == op) deleteAvl(rt, a);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">3</span> == op) cout&lt;&lt;getrank(rt, a)&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">4</span> == op) cout&lt;&lt;getnum(rt, a)&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">5</span> == op) cout&lt;&lt;predecessor(rt, a)&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">6</span> == op) cout&lt;&lt;successor(rt, a)&lt;&lt;endl;</span><br><span class="line">        <span class="comment">//if (7 == op) query(rt, a) == NULL? cout&lt;&lt;"No"&lt;&lt;endl : cout&lt;&lt;"Yes"&lt;&lt;endl;</span></span><br><span class="line">        <span class="comment">//if (8 == op) print(rt);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*char s[1];</span></span><br><span class="line"><span class="comment">    while (scanf("%s%d", s, &amp;a))&#123;</span></span><br><span class="line"><span class="comment">        if (s[0]=='I') insert(rt, a);</span></span><br><span class="line"><span class="comment">        if (s[0]=='Q') query(rt, a) == NULL? cout&lt;&lt;"No"&lt;&lt;endl : cout&lt;&lt;"Yes"&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        if (s[0]=='D') deleteAvl(rt, a);</span></span><br><span class="line"><span class="comment">        if (s[0]=='P') cout&lt;&lt;predecessor(rt, a)&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        if (s[0]=='S') cout&lt;&lt;successor(rt, a)&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        if (s[0]=='R') cout&lt;&lt;getrank(rt, a)&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        if (s[0]=='N') cout&lt;&lt;getnum(rt, a)&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">        if (s[0]=='E') break;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return 0;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">Copyright &copy; Yi Cai 2018</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
